<!DOCTYPE html>
<html>

<head>
  <title>Cachemulator: Final Report</title>
  <meta charset="UTF-8">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
  </script>
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body><xmp theme="simplex">
**Yuyang Guo** (yuyangg) and **Isaac Lim** (idl)

***
## False Sharing Example

### Implementation with false sharing

```
#define NUM_STUDENTS 100

static int grades[NUM_STUDENTS];

void *updateStudent(void *arg) {
  for (int j=0; j<100; j++) {
    int i = *(int *)arg;
    grades[i] = i*2+j;
  }
}
```

### Implementation without false sharing

```
#define NUM_STUDENTS 100
#define CACHE_LINE_SIZE 64

struct student {
  int grade;
  char pad[CACHE_LINE_SIZE-sizeof(int)];
};

static struct student grades[NUM_STUDENTS];

void *updateStudent(void *arg) {
  for (int j=0; j<100; j++) {
    int i = *(int *)arg;
    grades[i].grade = i*2+j;
  }
}
```

### Common main function

```
int main(int argc, char *argv[]) {
  pthread_t threads[NUM_STUDENTS];

  for (int i=0; i<NUM_STUDENTS; i++) {
    int *iptr = new int(i);
    pthread_create(&threads[i], 0, updateStudent, iptr);
  }

  for (int i=0; i<NUM_STUDENTS; i++) {
    pthread_join(threads[i], 0);
  }

  return 0;
}
```
</xmp></body>

<script src="http://strapdownjs.com/v/0.2/strapdown.js"></script>

</html>
